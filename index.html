<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="robots" content="noindex, nofollow">
  <title>D√ºsseldorf ‚Äî Carnival Survival</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root {
      --bg-main: #f7f5f2;
      --bg-card: #ffffff;
      --bg-subtle: #eeebe6;
      --text-primary: #1a1a1a;
      --text-secondary: #4a4a4a;
      --text-muted: #888888;
      --accent: #b8956c;
      --accent-dark: #96764d;
      --border: rgba(0, 0, 0, 0.08);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.08);
      --skyline-opacity: 0.04;
      --shop-color: #5b9bd5;
      --kiosk-color: #e67e22;
    }
    [data-theme="dark"] {
      --bg-main: #121417;
      --bg-card: #1a1d21;
      --bg-subtle: #22262b;
      --text-primary: #e8e6e3;
      --text-secondary: #a0a0a0;
      --text-muted: #666666;
      --border: rgba(255, 255, 255, 0.08);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.4);
      --skyline-opacity: 0.03;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; overflow-x: hidden; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      line-height: 1.6;
      font-weight: 400;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* ==================== SPLASH SCREEN ==================== */
    .splash-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-main); display: flex; flex-direction: column;
      align-items: center; justify-content: center; z-index: 1000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .splash-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .splash-content { text-align: center; padding: 0 32px; max-width: 400px; }
    .splash-title {
      font-family: 'Cormorant Garamond', serif; font-size: 2.8rem;
      font-weight: 500; letter-spacing: 0.15em; color: var(--text-primary); margin-bottom: 8px;
    }
    .splash-subtitle {
      font-size: 0.75rem; letter-spacing: 0.25em; text-transform: uppercase;
      color: var(--text-muted); margin-bottom: 32px;
    }
    .splash-skyline {
      width: 100%; max-width: 360px; margin: 0 auto 32px;
      display: flex; align-items: center; justify-content: center;
    }
    .splash-skyline:empty, .splash-skyline:not(:has(img[src]:not([src=""]))) { display: none; }
    .splash-skyline img { width: 100%; height: 80px; object-fit: contain; opacity: 0.15; }
    .splash-skyline img[src=""] { display: none; }
    [data-theme="dark"] .splash-skyline img { filter: invert(1); opacity: 0.12; }
    .enter-btn {
      display: inline-block; padding: 18px 48px; background: var(--accent);
      border: none; border-radius: 50px; color: white;
      font-family: 'Inter', sans-serif; font-size: 0.85rem; font-weight: 500;
      letter-spacing: 0.12em; text-transform: uppercase; cursor: pointer;
      box-shadow: 0 4px 20px rgba(184, 149, 108, 0.35); transition: all 0.3s ease;
    }
    .enter-btn:hover, .enter-btn:active { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(184, 149, 108, 0.45); }
    .splash-hint { margin-top: 24px; font-size: 0.7rem; color: var(--text-muted); }

    /* ==================== BURGER MENU ==================== */
    .burger-btn {
      background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px;
      padding: 10px 12px; cursor: pointer; display: flex; flex-direction: column;
      gap: 4px; transition: all 0.2s ease; z-index: 101;
    }
    .burger-btn:active { transform: scale(0.95); }
    .burger-btn span {
      display: block; width: 18px; height: 2px; background: var(--text-primary);
      border-radius: 2px; transition: all 0.3s ease;
    }
    .burger-btn.open span:nth-child(1) { transform: rotate(45deg) translate(4px, 4px); }
    .burger-btn.open span:nth-child(2) { opacity: 0; }
    .burger-btn.open span:nth-child(3) { transform: rotate(-45deg) translate(4px, -4px); }

    .nav-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); z-index: 99; opacity: 0;
      visibility: hidden; transition: all 0.3s ease;
    }
    .nav-overlay.visible { opacity: 1; visibility: visible; }

    .nav-drawer {
      position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
      background: var(--bg-main); z-index: 100; transition: left 0.3s ease;
      padding: 80px 24px 24px; overflow-y: auto;
      border-right: 1px solid var(--border);
    }
    .nav-drawer.open { left: 0; }
    .nav-drawer h3 {
      font-family: 'Cormorant Garamond', serif; font-size: 1.3rem;
      font-weight: 500; letter-spacing: 0.1em; margin-bottom: 24px; color: var(--text-primary);
    }
    .nav-item {
      display: flex; align-items: center; gap: 14px; padding: 16px 14px;
      border-radius: 14px; cursor: pointer; transition: all 0.2s ease;
      margin-bottom: 6px; color: var(--text-primary); text-decoration: none;
    }
    .nav-item:active, .nav-item.active { background: var(--bg-subtle); }
    .nav-item .nav-icon { font-size: 1.3rem; width: 28px; text-align: center; }
    .nav-item .nav-label { font-size: 0.9rem; font-weight: 500; }
    .nav-item .nav-desc { font-size: 0.7rem; color: var(--text-muted); }

    /* ==================== MAIN APP ==================== */
    .main-app { display: none; min-height: 100%; }
    .main-app.visible { display: block; animation: fadeIn 0.6s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .bg-skyline {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 120px;
      pointer-events: none; z-index: 0; opacity: var(--skyline-opacity);
      transition: opacity 0.3s ease; mix-blend-mode: multiply;
    }
    [data-theme="dark"] .bg-skyline { mix-blend-mode: screen; filter: invert(1); }

    .container { position: relative; z-index: 1; max-width: 440px; margin: 0 auto; padding: 0 20px 40px; }

    /* Pages */
    .page { display: none; }
    .page.visible { display: block; animation: fadeIn 0.3s ease; }

    /* Header */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 0 8px;
    }
    .header-left { display: flex; align-items: center; gap: 14px; }
    .header h1 {
      font-family: 'Cormorant Garamond', serif; font-size: 1.6rem;
      font-weight: 500; letter-spacing: 0.1em; color: var(--text-primary);
    }
    .theme-toggle {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 50px; padding: 8px 12px; cursor: pointer;
      font-size: 1rem; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;
    }
    .theme-toggle:active { transform: scale(0.95); }

    /* Weather bar */
    .weather-bar {
      display: flex; align-items: center; gap: 12px; padding: 14px 18px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 16px; margin-bottom: 16px; box-shadow: var(--shadow-sm);
      transition: background 0.3s ease; overflow: hidden;
    }
    .weather-icon { font-size: 1.8rem; min-width: 36px; display: flex; align-items: center; }
    .weather-info { flex: 1; }
    .weather-temp { font-size: 1.2rem; font-weight: 600; }
    .weather-desc { font-size: 0.72rem; color: var(--text-muted); text-transform: capitalize; }
    .weather-details { display: flex; gap: 12px; font-size: 0.7rem; color: var(--text-secondary); margin-top: 2px; }
    .weather-hourly {
      display: flex; gap: 10px; overflow-x: auto; padding: 10px 0 4px;
      scrollbar-width: none; -ms-overflow-style: none;
    }
    .weather-hourly::-webkit-scrollbar { display: none; }
    .weather-hour {
      display: flex; flex-direction: column; align-items: center; gap: 4px;
      min-width: 52px; padding: 8px 6px; background: var(--bg-subtle);
      border-radius: 12px; font-size: 0.68rem;
    }
    .weather-hour .time { color: var(--text-muted); }
    .weather-hour .temp { font-weight: 600; font-size: 0.8rem; }
    .weather-hour .icon { font-size: 1.1rem; }
    .weather-loading { text-align: center; padding: 8px; font-size: 0.8rem; color: var(--text-muted); }

    /* Main CTA */
    .main-cta { margin-bottom: 20px; }
    .home-btn {
      display: block; width: 100%; padding: 26px 24px;
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      border: none; border-radius: 20px; color: white;
      font-family: 'Cormorant Garamond', serif; font-size: 1.5rem;
      font-weight: 500; letter-spacing: 0.08em; cursor: pointer;
      text-decoration: none; text-align: center;
      box-shadow: var(--shadow-md), 0 4px 16px rgba(184, 149, 108, 0.3);
      transition: all 0.3s ease;
    }
    .home-btn:active { transform: scale(0.98); }
    .home-btn .icon { display: block; font-size: 1.8rem; margin-bottom: 6px; }
    .home-btn .sublabel {
      display: block; font-family: 'Inter', sans-serif; font-size: 0.65rem;
      letter-spacing: 0.1em; text-transform: uppercase; opacity: 0.9; margin-top: 6px;
    }

    .secondary-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 14px; }
    .sec-btn {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 6px; padding: 18px 16px; background: var(--bg-card);
      border: 1px solid var(--border); border-radius: 16px; color: var(--text-primary);
      text-decoration: none; font-size: 0.9rem; font-weight: 500;
      box-shadow: var(--shadow-sm); transition: all 0.2s ease;
    }
    .sec-btn:active { transform: scale(0.97); background: var(--bg-subtle); }
    .sec-btn .icon { font-size: 1.4rem; }

    /* Contacts */
    .contacts-toggle {
      width: 100%; padding: 14px 18px; margin-top: 12px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; color: var(--text-primary); font-family: 'Inter', sans-serif;
      font-size: 0.9rem; font-weight: 500; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      box-shadow: var(--shadow-sm); transition: all 0.2s ease;
    }
    .contacts-toggle:active { transform: scale(0.98); background: var(--bg-subtle); }
    .contacts-toggle .arrow { transition: transform 0.3s ease; }
    .contacts-toggle.open .arrow { transform: rotate(180deg); }
    .contacts-list { display: none; flex-direction: column; gap: 8px; margin-top: 12px; }
    .contacts-list.visible { display: flex; }
    .contact-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 16px; background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 12px; text-decoration: none; color: var(--text-primary); transition: all 0.2s ease;
    }
    .contact-item:active { transform: scale(0.98); background: var(--bg-subtle); }
    .contact-item .name { font-weight: 500; }
    .contact-item .phone { font-size: 0.85rem; color: var(--text-secondary); }
    .contact-item .call-icon { font-size: 1.2rem; }

    /* Disclaimer & Info */
    .disclaimer-box {
      background: var(--bg-card); border: 1px solid var(--border);
      border-left: 3px solid #e07070; border-radius: 12px;
      padding: 18px; margin: 20px 0; box-shadow: var(--shadow-sm);
    }
    .disclaimer-box .title { font-weight: 600; font-size: 0.95rem; color: #d45a5a; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .disclaimer-box p { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; margin-bottom: 8px; }
    .disclaimer-box p:last-child { margin-bottom: 0; }

    .info-box {
      background: var(--bg-card); border-left: 3px solid var(--accent);
      border-radius: 12px; padding: 16px 18px; margin: 20px 0;
      box-shadow: var(--shadow-sm); transition: background 0.3s ease;
    }
    .info-box ul { list-style: none; }
    .info-box li { font-size: 0.85rem; color: var(--text-secondary); padding: 6px 0; display: flex; align-items: flex-start; gap: 10px; }
    .info-box li strong { color: var(--text-primary); }
    .info-box .dot { width: 5px; height: 5px; min-width: 5px; background: var(--accent); border-radius: 50%; margin-top: 8px; }

    /* Section header */
    .section-header { display: flex; align-items: center; gap: 12px; margin: 28px 0 14px; }
    .section-header h2 { font-family: 'Cormorant Garamond', serif; font-size: 1.15rem; font-weight: 500; color: var(--text-primary); white-space: nowrap; }
    .section-header .line { flex: 1; height: 1px; background: var(--border); }

    /* Map */
    .map-container {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 20px; overflow: hidden; box-shadow: var(--shadow-md); transition: background 0.3s ease;
    }
    .map-header {
      padding: 14px 18px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
    }
    .map-header h3 { font-size: 0.9rem; font-weight: 500; }
    .map-status { font-size: 0.7rem; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }
    .pulse { width: 7px; height: 7px; background: #4CAF50; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    #live-map { height: 320px; width: 100%; background: var(--bg-subtle); }
    .map-btn {
      display: block; width: calc(100% - 28px); margin: 14px;
      padding: 14px 20px; background: var(--bg-subtle); border: 1px solid var(--border);
      border-radius: 12px; color: var(--text-primary); font-family: 'Inter', sans-serif;
      font-size: 0.85rem; font-weight: 500; cursor: pointer; text-align: center; transition: all 0.2s ease;
    }
    .map-btn:active { background: var(--border); }
    .map-btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 0 14px 14px; }
    .map-btn-sm {
      padding: 12px 10px; background: var(--bg-subtle); border: 1px solid var(--border);
      border-radius: 12px; color: var(--text-primary); font-family: 'Inter', sans-serif;
      font-size: 0.8rem; font-weight: 500; cursor: pointer; text-align: center; transition: all 0.2s ease;
    }
    .map-btn-sm:active { background: var(--border); }

    /* Map legend */
    .map-legend {
      display: flex; gap: 14px; padding: 10px 18px; flex-wrap: wrap;
      border-top: 1px solid var(--border);
    }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.7rem; color: var(--text-muted); }
    .legend-dot { width: 10px; height: 10px; border-radius: 50%; border: 2px solid #fff; }

    /* Fallback map */
    .fallback-map { display: none; padding: 16px; }
    .fallback-map.visible { display: block; }
    .fallback-map svg { width: 100%; height: auto; border-radius: 12px; }
    .fallback-notice { text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-top: 12px; }

    /* Toilet/shop list */
    .toilet-list, .shop-list { padding: 0 18px 18px; }
    .toilet-item, .shop-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 0; border-bottom: 1px solid var(--border);
      text-decoration: none; color: var(--text-primary);
    }
    .toilet-item:last-child, .shop-item:last-child { border-bottom: none; }
    .toilet-name, .shop-name { font-size: 0.85rem; font-weight: 500; }
    .toilet-type, .shop-type { font-size: 0.7rem; color: var(--text-muted); }
    .toilet-arrow, .shop-arrow { color: var(--text-muted); }

    details { padding: 0 18px 14px; }
    details summary { font-size: 0.8rem; color: var(--text-muted); cursor: pointer; padding: 8px 0; }
    details summary:hover { color: var(--text-secondary); }

    /* Tabs */
    .tabs {
      display: flex; background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 4px; margin-bottom: 14px;
      box-shadow: var(--shadow-sm); transition: background 0.3s ease;
    }
    .tab-btn {
      flex: 1; padding: 12px 14px; background: transparent; border: none;
      border-radius: 10px; font-family: 'Inter', sans-serif; font-size: 0.8rem;
      font-weight: 500; color: var(--text-muted); cursor: pointer; transition: all 0.2s ease;
    }
    .tab-btn.active { background: var(--accent); color: white; }
    .tab-content { display: none; }
    .tab-content.visible { display: block; animation: fadeIn 0.3s ease; }

    .spots-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 18px; overflow: hidden; box-shadow: var(--shadow-sm); transition: background 0.3s ease;
    }
    .spot-item {
      display: flex; align-items: center; padding: 16px 18px;
      border-bottom: 1px solid var(--border); text-decoration: none;
      color: var(--text-primary); transition: background 0.2s;
    }
    .spot-item:last-child { border-bottom: none; }
    .spot-item:active { background: var(--bg-subtle); }
    .spot-icon { font-size: 1.3rem; margin-right: 14px; width: 28px; text-align: center; }
    .spot-content { flex: 1; }
    .spot-name { font-weight: 500; font-size: 0.9rem; margin-bottom: 2px; }
    .spot-item.featured .spot-name { color: var(--accent); }
    .spot-comment { font-size: 0.72rem; color: var(--text-muted); }
    .spot-arrow { color: var(--text-muted); font-size: 1.1rem; }

    /* Detail overlay */
    .detail-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-main); z-index: 200; overflow-y: auto;
      display: none;
    }
    .detail-overlay.visible { display: block; animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .detail-header {
      display: flex; align-items: center; gap: 12px; padding: 20px;
      border-bottom: 1px solid var(--border);
    }
    .detail-back {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 12px; padding: 10px 14px; cursor: pointer;
      font-size: 0.85rem; font-weight: 500; color: var(--text-primary); transition: all 0.2s ease;
    }
    .detail-back:active { transform: scale(0.95); }
    .detail-title { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; font-weight: 500; }
    .detail-body { padding: 20px; max-width: 440px; margin: 0 auto; }
    .detail-image {
      width: 100%; height: 200px; border-radius: 16px;
      background: var(--bg-subtle); margin-bottom: 16px;
      display: flex; align-items: center; justify-content: center;
      font-size: 3rem; overflow: hidden;
    }
    .detail-image img { width: 100%; height: 100%; object-fit: cover; }
    .detail-info-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 16px; margin-bottom: 12px; box-shadow: var(--shadow-sm);
    }
    .detail-info-card h4 { font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; }
    .detail-info-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.83rem; }
    .detail-info-row .label { color: var(--text-muted); }
    .detail-nav-btn {
      display: block; width: 100%; padding: 16px; background: var(--accent);
      border: none; border-radius: 14px; color: white;
      font-family: 'Inter', sans-serif; font-size: 0.9rem; font-weight: 500;
      cursor: pointer; text-align: center; text-decoration: none; margin-top: 12px;
    }
    .detail-nav-btn:active { opacity: 0.9; }

    /* Webcam link */
    .webcam-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-sm);
      margin: 14px 0; text-decoration: none; display: block; color: var(--text-primary);
    }
    .webcam-card:active { opacity: 0.9; }
    .webcam-preview {
      width: 100%; height: 140px; background: var(--bg-subtle);
      display: flex; align-items: center; justify-content: center;
      font-size: 2.5rem; position: relative;
    }
    .webcam-preview .live-badge {
      position: absolute; top: 10px; right: 10px; background: #e74c3c;
      color: white; font-size: 0.6rem; font-weight: 600; padding: 4px 8px;
      border-radius: 6px; letter-spacing: 0.05em;
    }
    .webcam-info { padding: 12px 16px; }
    .webcam-info h4 { font-size: 0.85rem; font-weight: 500; }
    .webcam-info p { font-size: 0.72rem; color: var(--text-muted); }

    /* Phrase card */
    .phrase-card {
      background: var(--bg-card); border-left: 3px solid var(--accent);
      border-radius: 12px; padding: 18px 20px; margin: 24px 0;
      box-shadow: var(--shadow-sm); transition: background 0.3s ease;
    }
    .phrase-card .label { font-size: 0.65rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 10px; }
    .phrase-card .german { font-family: 'Cormorant Garamond', serif; font-size: 1.05rem; font-style: italic; color: var(--text-primary); margin-bottom: 6px; }
    .phrase-card .english { font-size: 0.72rem; color: var(--text-muted); }

    /* Footer */
    .footer { text-align: center; padding: 28px 0 16px; }
    .footer-label { font-size: 0.6rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 10px; }
    .footer-address { font-family: 'Cormorant Garamond', serif; font-size: 1rem; color: var(--text-secondary); line-height: 1.7; }
    .footer-phone { margin-top: 10px; }
    .footer-phone a { color: var(--accent); text-decoration: none; font-size: 1.05rem; font-weight: 500; }

    /* Leaflet overrides */
    .leaflet-popup-content-wrapper { border-radius: 12px; background: var(--bg-card); color: var(--text-primary); }
    .leaflet-popup-content { margin: 12px 14px; font-family: 'Inter', sans-serif; font-size: 0.85rem; }
    .leaflet-popup-tip { background: var(--bg-card); }
    .popup-title { font-weight: 600; margin-bottom: 4px; }
    .popup-type { color: var(--text-muted); font-size: 0.72rem; }
    .popup-btn {
      display: inline-block; margin-top: 8px; padding: 6px 12px;
      background: var(--accent); color: white; text-decoration: none;
      border-radius: 6px; font-size: 0.72rem; font-weight: 500;
    }
  </style>
</head>
<body>

<!-- ==================== SPLASH SCREEN ==================== -->
<div class="splash-screen" id="splash">
  <div class="splash-content">
    <h1 class="splash-title">D√úSSELDORF</h1>
    <p class="splash-subtitle">Carnival Survival Guide</p>
    <!-- ‚Üê PASTE D√úSSELDORF SKYLINE IMAGE BELOW (replace the src="") -->
    <div class="splash-skyline">
      <img src="" alt="D√ºsseldorf Skyline" onerror="this.style.display='none';">
    </div>
    <button class="enter-btn" onclick="enterApp()">Enter</button>
    <p class="splash-hint">Your emergency guide for carnival nights</p>
  </div>
</div>

<!-- ==================== NAV DRAWER ==================== -->
<div class="nav-overlay" id="navOverlay" onclick="closeNav()"></div>
<div class="nav-drawer" id="navDrawer">
  <h3>D√úSSELDORF</h3>
  <div class="nav-item active" onclick="navigateTo('home')">
    <span class="nav-icon">üè†</span>
    <div><div class="nav-label">Home</div><div class="nav-desc">Map, places & essentials</div></div>
  </div>
  <div class="nav-item" onclick="navigateTo('webcam')">
    <span class="nav-icon">üìπ</span>
    <div><div class="nav-label">Live Webcam</div><div class="nav-desc">Burgplatz live view</div></div>
  </div>
</div>

<!-- ==================== MAIN APP ==================== -->
<div class="main-app" id="mainApp">
  <div class="bg-skyline"></div>
  <div class="container">

    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="burger-btn" id="burgerBtn" onclick="toggleNav()">
          <span></span><span></span><span></span>
        </button>
        <h1>D√úSSELDORF</h1>
      </div>
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
        <span id="themeIcon">üåô</span>
      </button>
    </header>

    <!-- Weather Bar (hidden until loaded) -->
    <div class="weather-bar" id="weatherBar" style="display:none;">
      <div class="weather-loading" id="weatherLoading">Loading weather...</div>
      <div id="weatherContent" style="display:none; width:100%;">
        <div style="display:flex; align-items:center; gap:12px;">
          <span class="weather-icon" id="weatherIcon"></span>
          <div class="weather-info">
            <div class="weather-temp" id="weatherTemp"></div>
            <div class="weather-desc" id="weatherDesc"></div>
            <div class="weather-details">
              <span id="weatherWind"></span>
              <span id="weatherHumidity"></span>
            </div>
          </div>
        </div>
        <div class="weather-hourly" id="weatherHourly"></div>
      </div>
    </div>

    <!-- ==================== HOME PAGE ==================== -->
    <div class="page visible" id="page-home">

      <!-- Main CTA -->
      <section class="main-cta">
        <a href="uber://?action=setPickup&pickup=my_location&dropoff[latitude]=51.312718&dropoff[longitude]=6.822258&dropoff[nickname]=Home" class="home-btn">
          <span class="icon">üè†</span>
          Take Me Home (Uber)
          <span class="sublabel">Opens Uber ¬∑ One tap</span>
        </a>
        <div class="secondary-row">
          <a href="https://www.google.com/maps/dir/?api=1&destination=Heinrichstra√üe+1,+40880+Ratingen" class="sec-btn">
            <span class="icon">üìç</span> Google Maps
          </a>
          <a href="tel:+4917662172140" class="sec-btn">
            <span class="icon">üìû</span> Call Sophie
          </a>
        </div>
        <button class="contacts-toggle" onclick="toggleContacts()">
          <span>üë•</span> More Contacts <span class="arrow">‚ñº</span>
        </button>
        <div class="contacts-list" id="contactsList">
          <a href="tel:+491622714272" class="contact-item"><div><div class="name">Florian</div><div class="phone">+49 162 271 4272</div></div><span class="call-icon">üìû</span></a>
          <a href="tel:+41791542190" class="contact-item"><div><div class="name">Ansu</div><div class="phone">+41 79 154 21 90</div></div><span class="call-icon">üìû</span></a>
          <a href="tel:+447770758915" class="contact-item"><div><div class="name">Ben</div><div class="phone">+44 7770 758915</div></div><span class="call-icon">üìû</span></a>
          <a href="tel:+447483851859" class="contact-item"><div><div class="name">Joe</div><div class="phone">+44 7483 851859</div></div><span class="call-icon">üìû</span></a>
          <a href="tel:+447436065758" class="contact-item"><div><div class="name">James</div><div class="phone">+44 7436 065758</div></div><span class="call-icon">üìû</span></a>
        </div>
        <button class="contacts-toggle" onclick="shareLocation(event)" style="margin-top:8px;">
          <span>üì°</span> Share My Location
        </button>
      </section>

      <!-- Explore Map Section -->
      <div class="section-header">
        <h2>üó∫Ô∏è Explore Map</h2>
        <span class="line"></span>
      </div>

      <!-- Filter tabs for map -->
      <div class="tabs" id="mapFilterTabs">
        <button class="tab-btn active" onclick="filterMap('all')">All</button>
        <button class="tab-btn" onclick="filterMap('toilet')">üöΩ Toilets</button>
        <button class="tab-btn" onclick="filterMap('supermarket')">üõí Shops</button>
        <button class="tab-btn" onclick="filterMap('kiosk')">üè™ Kiosks</button>
      </div>

      <div class="map-container">
        <div class="map-header">
          <h3>üìç Nearby</h3>
          <span class="map-status" id="mapStatus"><span class="pulse"></span> Live</span>
        </div>
        <div id="live-map"></div>
        <div class="fallback-map" id="fallbackMap">
          <svg viewBox="0 0 400 320" xmlns="http://www.w3.org/2000/svg">
            <rect width="400" height="320" fill="var(--bg-subtle)"/>
            <path d="M0 280 Q100 260 200 270 Q300 280 400 260 L400 320 L0 320 Z" fill="#c5d5e4" opacity="0.5"/>
            <text x="350" y="300" fill="var(--text-muted)" font-size="10" font-family="Inter">Rhein</text>
            <circle cx="200" cy="210" r="12" fill="var(--accent)"/>
            <text x="200" y="190" fill="var(--text-primary)" font-size="8" font-family="Inter" font-weight="600" text-anchor="middle">Burgplatz</text>
          </svg>
          <p class="fallback-notice">üì¥ Offline mode</p>
        </div>
        <div class="map-legend">
          <div class="legend-item"><div class="legend-dot" style="background:var(--accent);"></div> Toilet</div>
          <div class="legend-item"><div class="legend-dot" style="background:var(--shop-color);"></div> Supermarket</div>
          <div class="legend-item"><div class="legend-dot" style="background:var(--kiosk-color);"></div> Kiosk</div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; padding:10px 14px 14px;">
          <button class="map-btn-sm" style="font-size:0.9rem; padding:14px 8px;" onclick="navigateToNearest()">üöΩ<br><b>Nearest Toilet</b></button>
          <button class="map-btn-sm" style="font-size:0.9rem; padding:14px 8px;" onclick="navigateToNearestShop('supermarket')">üõí<br><b>Nearest Shop</b></button>
          <button class="map-btn-sm" style="font-size:0.9rem; padding:14px 8px;" onclick="navigateToNearestShop('kiosk')">üè™<br><b>Nearest Kiosk</b></button>
        </div>
      </div>

      <!-- Safety Info -->
      <div class="disclaimer-box">
        <div class="title">‚ö†Ô∏è Stay Safe ‚Äî No Trouble</div>
        <p><strong>üö®</strong> Please avoid any conflict, no matter what happens. Walk away from trouble. The police are strict and will remove you immediately ‚Äî don't risk it.</p>
      </div>
      <div class="info-box">
        <ul>
          <li><span class="dot"></span><strong>No glass</strong> in Altstadt ‚Äî cans only!</li>
          <li><span class="dot"></span>Public peeing = <strong>‚Ç¨150 fine</strong></li>
          <li><span class="dot"></span>B√ºdchen (kiosk) cheaper than bars</li>
        </ul>
      </div>

      <!-- Places Section -->
      <div class="section-header">
        <h2>üìç Places</h2>
        <span class="line"></span>
      </div>
      <div class="tabs">
        <button class="tab-btn active" onclick="showTab('party')">üéâ Party</button>
        <button class="tab-btn" onclick="showTab('chill')">üòå Chill</button>
      </div>
      <div class="tab-content visible" id="party-tab">
        <div class="spots-card">
          <a href="javascript:void(0)" onclick="showDetail('burgplatz')" class="spot-item featured"><span class="spot-icon">üé™</span><div class="spot-content"><div class="spot-name">Burgplatz</div><div class="spot-comment">Main stage ¬∑ Big tent ¬∑ The heart of it all</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('marktplatz')" class="spot-item featured"><span class="spot-icon">üèõÔ∏è</span><div class="spot-content"><div class="spot-name">Marktplatz</div><div class="spot-comment">Open-air carnival hub ¬∑ Rathaus square</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('uerige')" class="spot-item featured"><span class="spot-icon">üç∫</span><div class="spot-content"><div class="spot-name">Uerige</div><div class="spot-comment">Legendary brewery ¬∑ Real D√ºsseldorf</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('stursula')" class="spot-item featured"><span class="spot-icon">‚õ™</span><div class="spot-content"><div class="spot-name">St. Ursula ¬∑ Ritterstra√üe</div><div class="spot-comment">Local favorite ¬∑ Less tourists</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('ratinger')" class="spot-item"><span class="spot-icon">üé∏</span><div class="spot-content"><div class="spot-name">Ratinger Stra√üe</div><div class="spot-comment">Locals' street ¬∑ Alternative bars</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('bolker')" class="spot-item"><span class="spot-icon">üåÄ</span><div class="spot-content"><div class="spot-name">Bolkerstra√üe</div><div class="spot-comment">Pure chaos ¬∑ You will lose someone</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('kabuffke')" class="spot-item"><span class="spot-icon">ü•É</span><div class="spot-content"><div class="spot-name">Et Kab√ºffke</div><div class="spot-comment">Tiny legend since 1858 ¬∑ Killepitsch!</div></div><span class="spot-arrow">‚Üí</span></a>
        </div>
      </div>
      <div class="tab-content" id="chill-tab">
        <div class="spots-card">
          <a href="javascript:void(0)" onclick="showDetail('hofgarten')" class="spot-item"><span class="spot-icon">üåø</span><div class="spot-content"><div class="spot-name">Hofgarten</div><div class="spot-comment">Park with benches ¬∑ Quiet escape</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('rheinufer')" class="spot-item"><span class="spot-icon">üåä</span><div class="spot-content"><div class="spot-name">Rhein Riverbank</div><div class="spot-comment">Fresh air ¬∑ Nice view ¬∑ Clear your head</div></div><span class="spot-arrow">‚Üí</span></a>
          <a href="javascript:void(0)" onclick="showDetail('matteo')" class="spot-item"><span class="spot-icon">üçï</span><div class="spot-content"><div class="spot-name">Pizzeria Matteo</div><div class="spot-comment">Open until 4-6am ¬∑ Late night savior</div></div><span class="spot-arrow">‚Üí</span></a>
        </div>
      </div>

      <!-- German Phrase -->
      <div class="phrase-card">
        <p class="label">üìã Show this if you're lost</p>
        <p class="german">"Ich bin verloren. K√∂nnen Sie mir helfen, diese Adresse zu finden?"</p>
        <p class="english">I'm lost. Can you help me find this address?</p>
      </div>

      <!-- Footer -->
      <footer class="footer">
        <p class="footer-label">Sophie's Place</p>
        <p class="footer-address">Heinrichstra√üe 1<br>40880 Ratingen</p>
        <p class="footer-phone"><a href="tel:+4917662172140">+49 176 621 72140</a></p>
      </footer>
    </div>

    <!-- ==================== WEBCAM PAGE ==================== -->
    <div class="page" id="page-webcam">
      <div class="section-header" style="margin-top:0;">
        <h2>üìπ Live Webcams</h2>
        <span class="line"></span>
      </div>

      <a href="https://livespotting.tv/deutschland/duesseldorf/fxmwsxp6" target="_blank" class="webcam-card">
        <div class="webcam-preview">
          üè∞
          <span class="live-badge">‚óè LIVE</span>
        </div>
        <div class="webcam-info">
          <h4>Burgplatz ¬∑ Schlossturm</h4>
          <p>Live view of Burgplatz, St. Lambertus & Oberkasseler Br√ºcke ‚Äî tap to watch</p>
        </div>
      </a>

      <a href="https://www.wetter.com/hd-live-webcams/deutschland/duesseldorf-burgplatz-am-rheinufer/663109f6de7ede301c043375/" target="_blank" class="webcam-card">
        <div class="webcam-preview">
          üåä
          <span class="live-badge">‚óè LIVE</span>
        </div>
        <div class="webcam-info">
          <h4>Rheinufer ¬∑ wetter.com</h4>
          <p>HD Live Webcam at the Rhine waterfront ‚Äî tap to watch</p>
        </div>
      </a>

      <div class="info-box">
        <ul>
          <li><span class="dot"></span>Check crowd levels before heading out</li>
          <li><span class="dot"></span>See the weather live at Burgplatz</li>
          <li><span class="dot"></span>Webcams run 24/7</li>
        </ul>
      </div>
    </div>

  </div>
</div>

<!-- ==================== DETAIL OVERLAY ==================== -->
<div class="detail-overlay" id="detailOverlay">
  <div class="detail-header">
    <button class="detail-back" onclick="closeDetail()">‚Üê Back</button>
    <span class="detail-title" id="detailTitle"></span>
  </div>
  <div class="detail-body" id="detailBody"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ==================== DATA ====================
const toilets = [
  { name: "Burgplatz (North)", lat: 51.22743, lng: 6.77196, type: "Pissoirs + WC" },
  { name: "Burgplatz (South)", lat: 51.22647, lng: 6.77210, type: "Pissoirs + WC" },
  { name: "St. Lambertus / Stiftsplatz", lat: 51.22834, lng: 6.77129, type: "WC Container" },
  { name: "Ritterstra√üe", lat: 51.22913, lng: 6.77303, type: "Pissoirs" },
  { name: "Marktplatz", lat: 51.22559, lng: 6.77132, type: "WC Container" },
  { name: "Carlsplatz", lat: 51.22372, lng: 6.77305, type: "WC" },
  { name: "Heinrich-Heine-Allee", lat: 51.22537, lng: 6.77676, type: "WC ¬∑ ‚Ç¨0.50 (paid)" }
];

const shops = [
  // Supermarkets ‚Äî Altstadt
  { name: "REWE", lat: 51.22535, lng: 6.77430, type: "supermarket", area: "Altstadt", desc: "Near Carlsplatz ¬∑ Cheapest option" },
  { name: "ALDI (Galeria)", lat: 51.22706, lng: 6.78708, type: "supermarket", area: "Altstadt", desc: "Inside Galeria building" },
  { name: "ALDI", lat: 51.22382, lng: 6.77460, type: "supermarket", area: "Altstadt", desc: "South of Carlsplatz" },
  { name: "REWE", lat: 51.22673, lng: 6.78345, type: "supermarket", area: "Altstadt", desc: "Friedrichstadt area" },
  { name: "REWE", lat: 51.22705, lng: 6.78592, type: "supermarket", area: "Altstadt", desc: "Oststra√üe area" },
  // Supermarket ‚Äî Home area
  { name: "Netto", lat: 51.22551, lng: 6.86292, type: "supermarket", area: "Home", desc: "Gerresheim area" },
  // Kiosks ‚Äî Altstadt (named)
  { name: "VIP Kiosk", lat: 51.22871, lng: 6.77233, type: "kiosk", area: "Altstadt", desc: "Near Ratinger Stra√üe" },
  { name: "Rhein Kiosk", lat: 51.22738, lng: 6.77247, type: "kiosk", area: "Altstadt", desc: "By the Rhine ¬∑ Burgplatz" },
  { name: "Kiosk am Burgplatz", lat: 51.22722, lng: 6.77239, type: "kiosk", area: "Altstadt", desc: "Right at Burgplatz" },
  { name: "Kiosk & Trinkhalle", lat: 51.22679, lng: 6.77348, type: "kiosk", area: "Altstadt", desc: "Drinks & snacks" },
  { name: "Bolker Shop", lat: 51.22724, lng: 6.77557, type: "kiosk", area: "Altstadt", desc: "Bolkerstra√üe 54 ¬∑ Snacks & drinks" },
  { name: "Multi-Kult Store", lat: 51.22698, lng: 6.77626, type: "kiosk", area: "Altstadt", desc: "Hunsr√ºckenstra√üe 44" },
  { name: "B√ºdchen Hunsr√ºckenstr.", lat: 51.22662, lng: 6.77562, type: "kiosk", area: "Altstadt", desc: "Hunsr√ºckenstra√üe 46" },
  { name: "Beckmann", lat: 51.22619, lng: 6.77581, type: "kiosk", area: "Altstadt", desc: "Flinger Stra√üe ¬∑ Open late" },
  { name: "B√ºdchen Neubr√ºckstr.", lat: 51.22586, lng: 6.77252, type: "kiosk", area: "Altstadt", desc: "Near Marktplatz" },
  { name: "Bier Paradies", lat: 51.22550, lng: 6.77270, type: "kiosk", area: "Altstadt", desc: "Neubr√ºckstra√üe 14 ¬∑ Beer heaven" },
  { name: "Fortuna B√ºdchen", lat: 51.22861, lng: 6.78751, type: "kiosk", area: "Altstadt", desc: "Cult kiosk ¬∑ Fortuna fans HQ" },
];

// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  HOW TO ADD PHOTOS TO PLACES:                               ‚ïë
// ‚ïë  Find the place below, paste your image URL or base64       ‚ïë
// ‚ïë  between the quotes "" after "image:".                      ‚ïë
// ‚ïë                                                              ‚ïë
// ‚ïë  Option A (URL):    image: "https://example.com/pic.jpg",  ‚ïë
// ‚ïë  Option B (Base64): image: "data:image/jpeg;base64,/9j/‚Ä¶", ‚ïë
// ‚ïë                                                              ‚ïë
// ‚ïë  Leave "" empty = emoji placeholder shown instead.           ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
const placeDetails = {
  burgplatz: {
    title: "Burgplatz",
    icon: "üé™",
    image: "https://rp-online.de/imgs/32/2/4/0/5/1/0/6/1/tok_f94cec540a23cbaf1cbbd0bc9203e08d/w620_h465_x310_y232_7fa3c7462a883b5b.jpg",
    desc: "The main carnival stage area. Biggest tent, biggest crowd, biggest energy. This is where D√ºsseldorf Karneval happens. The Schlossturm overlooks the Rhine and the party.",
    address: "Burgplatz, 40213 D√ºsseldorf",
    tips: "Get there early for a good spot. Watch your pockets. The Rheintreppe is perfect for a breather.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Burgplatz+D√ºsseldorf",
    webcam: "https://livespotting.tv/deutschland/duesseldorf/fxmwsxp6"
  },
  marktplatz: {
    title: "Marktplatz",
    icon: "üèõÔ∏è",
    image: "https://cdn.prod.www.spiegel.de/images/a2c57bb6-ce04-4f8b-997a-a27c50df59da_w1200_r1.33_fpx33.27_fpy50.jpg",
    desc: "The Marktplatz is the historic central square of the Altstadt, right in front of the Rathaus (city hall) and the Jan Wellem equestrian statue. During carnival it transforms into an open-air party zone with live stages, beer stands, and thousands of costumed revelers. Less tunnel-like than Bolkerstra√üe ‚Äî you can actually breathe here while still being in the thick of it.",
    address: "Marktplatz, 40213 D√ºsseldorf",
    tips: "Perfect meeting point ‚Äî easy to find, right in the center. The Uerige brewery is a 1-minute walk away. Grab an Alt there and come back to enjoy the square. At night the Rathaus is beautifully lit up.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=51.22588,6.77209",
    webcam: "https://www.duesseldorf.de/webcams/marktplatz-1"
  },
  uerige: {
    title: "Uerige",
    icon: "üç∫",
    image: "https://images.t-online.de/2026/02/WLYZSTEQvZv3/0x209:4000x2250/fit-in/646x0/image.jpg",
    desc: "The most legendary Altbier brewery in D√ºsseldorf. Established in 1862. The K√∂bes (waiter) will just keep putting fresh glasses on your table. Say 'Deckel drauf' to stop.",
    address: "Berger Str. 1, 40213 D√ºsseldorf",
    tips: "Order 'Ein Alt, bitte.' The K√∂bes might seem rude ‚Äî that's tradition, not personal. Stand-up spots in the back are the real deal.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Uerige+D√ºsseldorf"
  },
  stursula: {
    title: "St. Ursula ¬∑ Ritterstra√üe",
    icon: "‚õ™",
    image: "https://rp-online.de/imgs/32/2/3/7/0/9/1/3/3/tok_d2063877d046a09e42869c139c626061/w940_h528_x470_y264_6fa4133468839919.JPG",
    desc: "Where the locals celebrate. Less touristy than Bolkerstra√üe, more authentic. The area around St. Ursula church transforms during carnival ‚Äî outdoor stages and smaller tents.",
    address: "Ritterstra√üe, 40213 D√ºsseldorf",
    tips: "This is the spot if you want to feel actual D√ºsseldorf Karneval instead of just tourist chaos. Nearby kiosks are cheaper than bars.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Ritterstra√üe+St+Ursula+D√ºsseldorf"
  },
  ratinger: {
    title: "Ratinger Stra√üe",
    icon: "üé∏",
    image: "https://zuruel.de/wp-content/uploads/2011/08/slideshow-28.jpg",
    desc: "The alternative heart of the Altstadt. Less mainstream, more rock'n'roll. This is where D√ºsseldorfers hang ‚Äî not tourists. Legendary punk and music bar scene since the 80s.",
    address: "Ratinger Stra√üe, 40213 D√ºsseldorf",
    tips: "Check out the bars along the street ‚Äî each has its own vibe. It gets busy but never as insane as Bolkerstra√üe. Good mix of ages.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Ratinger+Stra√üe+D√ºsseldorf"
  },
  bolker: {
    title: "Bolkerstra√üe",
    icon: "üåÄ",
    image: "https://images.bild.de/6162e9402804263c7775064a/c185db46e3170834d202c91a88649994,a91a5e85?w=1280",
    desc: "Pure, concentrated carnival chaos. Wall-to-wall people, shoulder-to-shoulder drinking. Heinrich Heine was born here ‚Äî he'd barely recognize it during Karneval.",
    address: "Bolkerstra√üe, 40213 D√ºsseldorf",
    tips: "You WILL lose someone here. Set a meeting point before going in. Keep your phone charged. Don't wear anything you love ‚Äî it will get beer on it.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Bolkerstra√üe+D√ºsseldorf"
  },
  kabuffke: {
    title: "Et Kab√ºffke",
    icon: "ü•É",
    image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/15/dd/7e/fc/20181222-182010-largejpg.jpg?w=700&h=-1&s=1",
    desc: "A tiny legendary kiosk bar since 1858. Famous for Killepitsch ‚Äî a deep red herbal liqueur that is THE drink of D√ºsseldorf. Made from 98 fruits, berries and herbs.",
    address: "Flinger Str. 1, 40213 D√ºsseldorf",
    tips: "Order a Killepitsch. It's sweet, strong, and dangerously easy to drink. They also sell bottles to take home ‚Äî great souvenir.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Et+Kab√ºffke+Flinger+Stra√üe+D√ºsseldorf"
  },
  hofgarten: {
    title: "Hofgarten",
    icon: "üåø",
    image: "https://cdn.getyourguide.com/image/format=auto,fit=crop,gravity=center,quality=60,width=400,height=265,dpr=2/tour_img/30f4708a6a00510a24fee289db3ba7d338dcef93464f8a0bccfaacd75d0fb44a.jpeg",
    desc: "D√ºsseldorf's oldest and most beautiful park. Right next to the Altstadt but a completely different world ‚Äî quiet paths, old trees, benches by the pond.",
    address: "Hofgarten, 40479 D√ºsseldorf",
    tips: "Sit on the benches near the J√§gerhof museum entrance for the most peaceful spot. Public toilets nearby at Schadowstra√üe.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Hofgarten+Schadowstra√üe+D√ºsseldorf"
  },
  rheinufer: {
    title: "Rhein Riverbank",
    icon: "üåä",
    image: "https://www.24rhein.de/assets/images/30/701/30701880-rheinpromenade-duesseldorf-kugelfoermigen-leuchten-beleuchtung-sicherheit-2qEJxoeJq1e9.jpg",
    desc: "The Rhine promenade stretches along the water. Fresh air, wide views, and river barges. During carnival, people sit on the Rheintreppe steps with drinks.",
    address: "Rheinuferpromenade, 40213 D√ºsseldorf",
    tips: "The steps at Burgplatz are the best spot. Bring a drink from a B√ºdchen ‚Äî way cheaper than any bar.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Rheinufer+D√ºsseldorf+Altstadt"
  },
  matteo: {
    title: "Pizzeria Matteo",
    icon: "üçï",
    image: "https://pizzeriaristorantematteo.shop/public/media/pizzeriaristorantematteo-shop/1.jpg",
    desc: "Your late-night savior. Open until 4-6am during carnival weekends. Authentic Italian pizza that tastes even better at 3am.",
    address: "Hunsr√ºckenstra√üe 34, 40213 D√ºsseldorf",
    tips: "The Margherita is perfect. Cash is faster. If the queue is too long, try the D√∂ner places on Bolkerstra√üe as backup.",
    navUrl: "https://www.google.com/maps/search/?api=1&query=Pizzeria+Matteo+Hunsr√ºckenstra√üe+D√ºsseldorf"
  }
};

// ==================== STATE ====================
let userLat = null, userLng = null;
let homeMap = null;
let userMarkerHome = null;
let mapLoaded = false;
let allMapMarkers = [];

// ==================== THEME ====================
function toggleTheme() {
  const body = document.body;
  const icon = document.getElementById('themeIcon');
  if (body.getAttribute('data-theme') === 'dark') {
    body.removeAttribute('data-theme');
    icon.textContent = 'üåô';
    localStorage.setItem('theme', 'light');
  } else {
    body.setAttribute('data-theme', 'dark');
    icon.textContent = '‚òÄÔ∏è';
    localStorage.setItem('theme', 'dark');
  }
}
function loadTheme() {
  const saved = localStorage.getItem('theme');
  const icon = document.getElementById('themeIcon');
  if (saved === 'dark') {
    document.body.setAttribute('data-theme', 'dark');
    if (icon) icon.textContent = '‚òÄÔ∏è';
  }
}

// ==================== NAVIGATION ====================
function enterApp() {
  document.getElementById('splash').classList.add('hidden');
  document.getElementById('mainApp').classList.add('visible');
  loadTheme();
  initHomeMap();
  loadWeather();
  trackLocation();
}

function toggleNav() {
  const drawer = document.getElementById('navDrawer');
  const overlay = document.getElementById('navOverlay');
  const btn = document.getElementById('burgerBtn');
  const isOpen = drawer.classList.contains('open');
  if (isOpen) { closeNav(); } else {
    drawer.classList.add('open');
    overlay.classList.add('visible');
    btn.classList.add('open');
  }
}
function closeNav() {
  document.getElementById('navDrawer').classList.remove('open');
  document.getElementById('navOverlay').classList.remove('visible');
  document.getElementById('burgerBtn').classList.remove('open');
}

function navigateTo(page) {
  closeNav();
  document.querySelectorAll('.page').forEach(p => p.classList.remove('visible'));
  document.getElementById('page-' + page).classList.add('visible');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  event.currentTarget?.classList.add('active');
  window.scrollTo(0, 0);
}

// ==================== CONTACTS ====================
function toggleContacts() {
  const list = document.getElementById('contactsList');
  const btn = document.querySelector('.contacts-toggle');
  list.classList.toggle('visible');
  btn.classList.toggle('open');
}

// ==================== TABS ====================
function showTab(tab) {
  const homeTabs = document.querySelectorAll('#page-home .tabs')[1];
  if (!homeTabs) return;
  const btns = homeTabs.querySelectorAll('.tab-btn');
  btns.forEach(b => b.classList.remove('active'));
  document.querySelectorAll('#party-tab, #chill-tab').forEach(c => c.classList.remove('visible'));
  if (tab === 'party') {
    btns[0].classList.add('active');
    document.getElementById('party-tab').classList.add('visible');
  } else {
    btns[1].classList.add('active');
    document.getElementById('chill-tab').classList.add('visible');
  }
}

// ==================== SHARE LOCATION ====================
function shareLocation(e) {
  e.preventDefault();
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const url = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
      if (navigator.share) {
        navigator.share({ title: 'My Location', text: 'Here is my location:', url: url });
      } else {
        window.open(`sms:?body=Hey, here is my location: ${encodeURIComponent(url)}`);
      }
    }, () => {
      alert('Could not get your location. Please enable GPS.');
    });
  }
}
// (WhatsApp share removed)

// ==================== LOCATION TRACKING ====================
function trackLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(
      pos => { userLat = pos.coords.latitude; userLng = pos.coords.longitude; updateUserMarkers(); },
      () => {},
      { enableHighAccuracy: true, maximumAge: 10000 }
    );
  }
}
function updateUserMarkers() {
  if (!userLat || !homeMap) return;
  if (userMarkerHome) { userMarkerHome.setLatLng([userLat, userLng]); }
  else {
    userMarkerHome = L.circleMarker([userLat, userLng], {
      radius: 8, fillColor: '#4285f4', color: '#fff', weight: 3, fillOpacity: 1
    }).addTo(homeMap).bindPopup("üìç You");
  }
}

// ==================== UNIFIED MAP ====================
function initHomeMap() {
  if (typeof L === 'undefined') { showFallbackMap(); return; }
  try {
    homeMap = L.map('live-map', { zoomControl: false, attributionControl: false }).setView([51.2270, 6.7740], 15);
    const isDark = document.body.getAttribute('data-theme') === 'dark';
    const tileUrl = isDark ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png' : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
    L.tileLayer(tileUrl, { maxZoom: 19 }).addTo(homeMap);
    L.control.zoom({ position: 'bottomright' }).addTo(homeMap);

    // Toilets
    toilets.forEach(t => {
      const m = L.circleMarker([t.lat, t.lng], { radius: 10, fillColor: '#b8956c', color: '#fff', weight: 3, fillOpacity: 1 }).addTo(homeMap)
        .bindPopup(`<div class="popup-title">üöΩ ${t.name}</div><div class="popup-type">${t.type}</div><a href="https://www.google.com/maps/dir/?api=1&destination=${t.lat},${t.lng}&travelmode=walking" class="popup-btn" target="_blank">Google Maps ‚Üí</a>`);
      allMapMarkers.push({ marker: m, type: 'toilet' });
    });
    // Shops & Kiosks
    shops.forEach(s => {
      const color = s.type === 'supermarket' ? '#5b9bd5' : '#e67e22';
      const icon = s.type === 'supermarket' ? 'üõí' : 'üè™';
      const m = L.circleMarker([s.lat, s.lng], { radius: 9, fillColor: color, color: '#fff', weight: 2, fillOpacity: 1 }).addTo(homeMap)
        .bindPopup(`<div class="popup-title">${icon} ${s.name}</div><div class="popup-type">${s.desc}</div><a href="https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}&travelmode=walking" class="popup-btn" target="_blank">Google Maps ‚Üí</a>`);
      allMapMarkers.push({ marker: m, type: s.type });
    });
    mapLoaded = true;
  } catch (e) { showFallbackMap(); }
}
function showFallbackMap() {
  document.getElementById('live-map').style.display = 'none';
  document.getElementById('fallbackMap').classList.add('visible');
  document.getElementById('mapStatus').innerHTML = 'üì¥ Offline';
}

// ==================== MAP FILTER ====================
function filterMap(type) {
  const btns = document.querySelectorAll('#mapFilterTabs .tab-btn');
  btns.forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');
  allMapMarkers.forEach(item => {
    if (type === 'all') { item.marker.addTo(homeMap); }
    else if (item.type === type) { item.marker.addTo(homeMap); }
    else { homeMap.removeLayer(item.marker); }
  });
}

// ==================== NAVIGATE TO NEAREST ====================
function navigateToNearest() {
  if (!userLat || !userLng) {
    window.open('https://www.google.com/maps/dir/?api=1&destination=51.22743,6.77196&travelmode=walking', '_blank');
    return;
  }
  let nearest = null, minDist = Infinity;
  toilets.forEach(t => {
    const dist = Math.sqrt(Math.pow(t.lat - userLat, 2) + Math.pow(t.lng - userLng, 2));
    if (dist < minDist) { minDist = dist; nearest = t; }
  });
  if (nearest) window.open(`https://www.google.com/maps/dir/?api=1&destination=${nearest.lat},${nearest.lng}&travelmode=walking`, '_blank');
}

function navigateToNearestShop(type) {
  const filtered = shops.filter(s => s.type === type);
  if (!userLat || !userLng) {
    const fallback = filtered[0];
    window.open(`https://www.google.com/maps/dir/?api=1&destination=${fallback.lat},${fallback.lng}&travelmode=walking`, '_blank');
    return;
  }
  let nearest = null, minDist = Infinity;
  filtered.forEach(s => {
    const dist = Math.sqrt(Math.pow(s.lat - userLat, 2) + Math.pow(s.lng - userLng, 2));
    if (dist < minDist) { minDist = dist; nearest = s; }
  });
  if (nearest) window.open(`https://www.google.com/maps/dir/?api=1&destination=${nearest.lat},${nearest.lng}&travelmode=walking`, '_blank');
}

// ==================== DETAIL OVERLAY ====================
function showDetail(key) {
  const d = placeDetails[key];
  if (!d) return;
  document.getElementById('detailTitle').textContent = d.title;
  let webcamHtml = '';
  if (d.webcam) {
    webcamHtml = `<a href="${d.webcam}" target="_blank" class="webcam-card" style="margin-top:12px;">
      <div class="webcam-preview" style="height:80px; font-size:1.5rem;">üìπ <span class="live-badge">‚óè LIVE</span></div>
      <div class="webcam-info"><h4>Live Webcam</h4><p>Tap to see this place live</p></div>
    </a>`;
  }
  document.getElementById('detailBody').innerHTML = `
    <div class="detail-image">${d.image ? '<img src="'+d.image+'" alt="'+d.title+'" style="width:100%;height:100%;object-fit:cover;">' : '<span style="font-size:3rem">'+d.icon+'</span><br><span style="font-size:0.7rem;color:var(--text-muted)">Replace image: set image property in placeDetails.'+key+'</span>'}</div>
    <div class="detail-info-card">
      <h4>About</h4>
      <p style="font-size:0.85rem; color:var(--text-secondary); line-height:1.6;">${d.desc}</p>
    </div>
    <div class="detail-info-card">
      <h4>üìç Address</h4>
      <p style="font-size:0.85rem; color:var(--text-secondary);">${d.address}</p>
    </div>
    <div class="detail-info-card">
      <h4>üí° Tips</h4>
      <p style="font-size:0.85rem; color:var(--text-secondary); line-height:1.6;">${d.tips}</p>
    </div>
    ${webcamHtml}
    <a href="${d.navUrl}" target="_blank" class="detail-nav-btn">üìç Open in Google Maps</a>
  `;
  document.getElementById('detailOverlay').classList.add('visible');
}
function closeDetail() {
  document.getElementById('detailOverlay').classList.remove('visible');
}

// ==================== WEATHER ====================
function getWeatherEmoji(code) {
  if (code >= 200 && code < 300) return '‚õàÔ∏è';
  if (code >= 300 && code < 500) return 'üå¶Ô∏è';
  if (code >= 500 && code < 600) return 'üåßÔ∏è';
  if (code >= 600 && code < 700) return 'üå®Ô∏è';
  if (code >= 700 && code < 800) return 'üå´Ô∏è';
  if (code === 800) return '‚òÄÔ∏è';
  if (code === 801) return 'üå§Ô∏è';
  if (code >= 802 && code <= 804) return '‚òÅÔ∏è';
  return 'üå°Ô∏è';
}

async function loadWeather() {
  const API_KEY = 'c303c5eecd724a6ce547c60764492fc2';
  try {
    // Current weather
    const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Dusseldorf&appid=${API_KEY}&units=metric&lang=en`);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    if (data.cod !== 200) throw new Error('API error');

    const iconCode = data.weather[0].icon;
    const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
    document.getElementById('weatherIcon').innerHTML = `<img src="${iconUrl}" alt="weather" style="width:40px;height:40px;">`;
    document.getElementById('weatherTemp').textContent = Math.round(data.main.temp) + '¬∞C';
    document.getElementById('weatherDesc').textContent = data.weather[0].description;
    document.getElementById('weatherWind').textContent = 'üí® ' + Math.round(data.wind.speed * 3.6) + ' km/h';
    document.getElementById('weatherHumidity').textContent = 'üíß ' + data.main.humidity + '%';

    // 3-hour forecast
    const fRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=Dusseldorf&appid=${API_KEY}&units=metric&lang=en&cnt=8`);
    if (fRes.ok) {
      const fData = await fRes.json();
      const hourlyEl = document.getElementById('weatherHourly');
      hourlyEl.innerHTML = '';
      fData.list.forEach(h => {
        const time = new Date(h.dt * 1000);
        const hour = time.getHours().toString().padStart(2, '0') + ':00';
        const hIcon = h.weather[0].icon;
        hourlyEl.innerHTML += `<div class="weather-hour"><span class="time">${hour}</span><img src="https://openweathermap.org/img/wn/${hIcon}.png" style="width:28px;height:28px;"><span class="temp">${Math.round(h.main.temp)}¬∞</span></div>`;
      });
    }

    document.getElementById('weatherBar').style.display = 'flex';
    document.getElementById('weatherLoading').style.display = 'none';
    document.getElementById('weatherContent').style.display = 'block';
  } catch (e) {
    console.error('Weather error:', e);
    // Don't show bar if weather fails
  }
}

// ==================== INIT ====================
window.addEventListener('offline', showFallbackMap);
loadTheme();
</script>
</body>
</html>
